<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning Validation Tool | HSE Capital & Estates</title>
    
    <link rel="icon" href="https://assets.hse.ie/static/hse-frontend/assets/favicons/favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --hse-primary: #006858;
            --hse-secondary: #00bfa5;
            --hse-dark: #004d42;
        }

        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background-color: #f8fafc;
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
        }

        .hse-gradient {
            background: linear-gradient(135deg, var(--hse-primary) 0%, var(--hse-dark) 100%);
        }

        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* PRINT STYLES */
        @media print {
            @page { margin: 1.5cm; size: A4; }
            body { background: white; color: black; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .hse-gradient { background: none !important; color: black !important; padding: 0 !important; }
            .shadow-sm, .shadow-md, .shadow-lg { box-shadow: none !important; border: 1px solid #e2e8f0 !important; }
            button { display: none !important; }
            header { border-bottom: 2px solid #006858 !important; padding-bottom: 20px !important; margin-bottom: 30px !important; }
        }
        .print-only { display: none; }
    </style>
</head>
<body class="selection:bg-emerald-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Inline for portability) ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        // Icon Paths
        const Icons = {
            MapPin: (p) => <Icon {...p} path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>} />,
            Building2: (p) => <Icon {...p} path={<><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></>} />,
            Trees: (p) => <Icon {...p} path={<><path d="M10 10v.2A3 3 0 0 1 8.9 16v0H5v0h0a3 3 0 0 1-1-5.8V10a3 3 0 0 1 5.3-2.1"/><path d="M7 16v6"/><path d="M13 19v3"/><path d="M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .6-1.7L13 2.6a1 1 0 0 0-1.7 0L8.6 7.3a1 1 0 0 0 .6 1.7H9.4L7 12.3a1 1 0 0 0 .7 1.7Z"/></>} />,
            Mountain: (p) => <Icon {...p} path={<><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></>} />,
            CheckCircle: (p) => <Icon {...p} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />,
            ArrowRight: (p) => <Icon {...p} path={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />,
            Info: (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></>} />,
            Calculator: (p) => <Icon {...p} path={<><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="8" y1="18" x2="8" y2="18"/></>} />,
            PenTool: (p) => <Icon {...p} path={<><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></>} />,
            Copy: (p) => <Icon {...p} path={<><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></>} />,
            Printer: (p) => <Icon {...p} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></>} />,
            Save: (p) => <Icon {...p} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
            Upload: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></>} />,
            CheckSquare: (p) => <Icon {...p} path={<><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></>} />,
            Square: (p) => <Icon {...p} path={<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>} />,
            AlertCircle: (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>} />,
            Home: (p) => <Icon {...p} path={<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>} />,
            Tractor: (p) => <Icon {...p} path={<><path d="M3 4h9l1 7h-9z"/><path d="M4 11V4"/><path d="M8 11V4"/><path d="M18 5c-.6 0-1 .4-1 1v5.6"/><path d="m10 11 11 .9c.6 0 .9.5.8 1.1l-.8 5a1 1 0 0 1-1.1.8H6a1 1 0 0 1-1-1l.8-5c0-.6.5-1 1-1.1L10 11z"/><circle cx="18" cy="18" r="4"/><circle cx="7" cy="18" r="4"/><path d="M10.5 17h.5"/></>} />,
            Calendar: (p) => <Icon {...p} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>} />,
            FileText: (p) => <Icon {...p} path={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></>} />,
            HardHat: (p) => <Icon {...p} path={<><path d="M2 12h20"/><path d="M10 16v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4"/><path d="M14 16v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-4"/><path d="M12 2a8 8 0 0 0-8 10h16a8 8 0 0 0-8-10Z"/></>} />,
            ChevronRight: (p) => <Icon {...p} path={<polyline points="9 18 15 12 9 6" />} />
        };

        const PlanningCalculator = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [projectName, setProjectName] = useState("My Planning Project");
            const [authority, setAuthority] = useState(null); 
            const [projectType, setProjectType] = useState(null);
            const [checklist, setChecklist] = useState({});
            const [validationError, setValidationError] = useState(null);

            // Tools State
            const [noticeDetails, setNoticeDetails] = useState({ applicant: '', address: '', description: '', type: 'Permission' });
            const [generatedNotice, setGeneratedNotice] = useState('');
            const [noticeError, setNoticeError] = useState(''); // NEW: Local error state for notice generator
            const [feeSettings, setFeeSettings] = useState({ category: 'house', units: 1, area: 0, retention: false });
            const [calculatedFee, setCalculatedFee] = useState(0);

            // --- PERSISTENCE ---
            useEffect(() => {
                const savedData = localStorage.getItem('hse_planning_tool_data');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setProjectName(parsed.projectName || "My Planning Project");
                        setCurrentStep(parsed.currentStep || 0);
                        setAuthority(parsed.authority);
                        setProjectType(parsed.projectType);
                        setChecklist(parsed.checklist || {});
                        setNoticeDetails(parsed.noticeDetails || { applicant: '', address: '', description: '', type: 'Permission' });
                        setFeeSettings(parsed.feeSettings || { category: 'house', units: 1, area: 0, retention: false });
                    } catch (e) { console.error("Load error", e); }
                }
            }, []);

            useEffect(() => {
                const dataToSave = { projectName, currentStep, authority, projectType, checklist, noticeDetails, feeSettings };
                localStorage.setItem('hse_planning_tool_data', JSON.stringify(dataToSave));
            }, [projectName, currentStep, authority, projectType, checklist, noticeDetails, feeSettings]);

            // --- LOGIC ---
            useEffect(() => {
                let total = 0;
                const { category, units, area, retention } = feeSettings;
                const multiplier = retention ? 3 : 1;
                if (category === 'house') total = 65 * units;
                else if (category === 'extension') total = 34;
                else if (category === 'commercial') total = Math.max(80, 3.60 * area);
                else if (category === 'ag') total = Math.max(80, 80); 
                setCalculatedFee(total * multiplier);
            }, [feeSettings]);

            const generateNoticeText = () => {
                // Validation for missing fields
                if (!noticeDetails.applicant || !noticeDetails.address || !noticeDetails.description) {
                    setNoticeError("Please fill in Applicant Name, Address, and Description.");
                    return;
                }
                setNoticeError(""); // Clear error if successful
                
                let authorityName = "PLANNING AUTHORITY";
                if (authority === 'city') authorityName = "CORK CITY COUNCIL";
                else if (authority === 'county') authorityName = "CORK COUNTY COUNCIL";
                else if (authority === 'kerry') authorityName = "KERRY COUNTY COUNCIL";

                const text = `${authorityName}\n\nI, ${noticeDetails.applicant}, intend to apply for ${noticeDetails.type} for development at this site address:\n${noticeDetails.address}.\n\nThe development will consist of:\n${noticeDetails.description}.\n\nThe planning application may be inspected, or purchased at a fee not exceeding the reasonable cost of making a copy, at the offices of the Planning Authority during its public opening hours and a submission or observation in relation to the application may be made to the Authority in writing on payment of the prescribed fee within the period of 5 weeks beginning on the date of receipt by the Authority of the application.`;
                setGeneratedNotice(text);
            };

            const exportData = () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(localStorage.getItem('hse_planning_tool_data')));
                const node = document.createElement('a');
                node.setAttribute("href", dataStr);
                node.setAttribute("download", `${projectName.replace(/\s+/g, '_')}_backup.json`);
                document.body.appendChild(node);
                node.click();
                node.remove();
            };

            const triggerImport = () => document.getElementById('fileInput').click();
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const raw = JSON.parse(decodeURIComponent(event.target.result.replace("data:text/json;charset=utf-8,", "")));
                        const parsed = JSON.parse(raw);
                        setProjectName(parsed.projectName); setAuthority(parsed.authority); setProjectType(parsed.projectType);
                        setChecklist(parsed.checklist); setNoticeDetails(parsed.noticeDetails); setFeeSettings(parsed.feeSettings);
                        setCurrentStep(parsed.currentStep);
                        alert("Project Data Loaded");
                    } catch (err) { alert("Error loading file."); }
                };
                reader.readAsText(file);
            };

            // --- NAV ---
            const selectAuthority = (auth) => { setAuthority(auth); setValidationError(null); setCurrentStep(prev => prev + 1); window.scrollTo(0,0); };
            const selectProject = (type) => { setProjectType(type); setValidationError(null); setCurrentStep(prev => prev + 1); window.scrollTo(0,0); };
            const handleNext = () => {
                const error = validateStep();
                if (error) setValidationError(error);
                else { setValidationError(null); setCurrentStep(prev => Math.min(prev + 1, steps.length - 1)); window.scrollTo(0,0); }
            };
            const handleBack = () => { setValidationError(null); setCurrentStep(prev => Math.max(prev - 1, 0)); window.scrollTo(0,0); };
            const toggleCheck = (id) => { setChecklist(prev => ({ ...prev, [id]: !prev[id] })); if (validationError) setValidationError(null); };

            const validateStep = () => {
                let error = null;
                if (currentStep === 1) {
                    if (!checklist['strat_npf']) error = "You must confirm alignment with the National Planning Framework.";
                    
                    if (authority === 'city') {
                        if (!checklist['strat_zone_fav']) error = "You must confirm zoning compliance.";
                    } else if (authority === 'county') {
                        if (!checklist['strat_strong_urban']) error = "You must acknowledge the Rural Policy Area.";
                    } else if (authority === 'kerry') {
                         if (!checklist['strat_kerry_settlement']) error = "You must confirm alignment with Kerry Settlement Policy.";
                    }
                }
                if (currentStep === 3) {
                    const required = ['pp_map', 'pp_layout', 'pp_proof'];
                    if (required.some(id => !checklist[id])) error = "Please confirm mandatory documents.";
                }
                if (currentStep === 4) {
                    const required = ['app_news', 'app_submit', 'app_site_notice', 'app_fee_pd'];
                    if (required.some(id => !checklist[id])) error = "Confirm statutory requirements to avoid invalidation.";
                }
                if (currentStep === 5) {
                    if (authority === 'county' && !checklist['rur_sec47']) error = "You must accept the Section 47 Occupancy condition.";
                    if (authority === 'kerry' && !checklist['kerry_occupancy']) error = "You must accept the Occupancy Clause condition.";
                }
                return error;
            };

            const steps = [
                { title: "Start", icon: Icons.MapPin }, { title: "Strategy", icon: Icons.Info },
                { title: "Exemptions", icon: Icons.CheckCircle }, { title: "Pre-Planning", icon: Icons.Calendar },
                { title: "Application", icon: Icons.FileText }, { title: "Sector Specifics", icon: Icons.Building2 },
                { title: "Construction", icon: Icons.HardHat },
            ];

            // --- COMPONENTS ---
            const CheckItem = ({ id, text, subtext, required = false }) => (
                <div onClick={() => toggleCheck(id)} className={`flex items-start p-4 rounded-xl border transition-all cursor-pointer group mb-3 relative overflow-hidden ${checklist[id] ? 'bg-emerald-50 border-emerald-500 shadow-sm' : required && validationError ? 'bg-red-50 border-red-300 animate-pulse' : 'bg-white border-slate-200 hover:border-emerald-500 hover:shadow-md'}`}>
                    {required && !checklist[id] && <div className="absolute left-0 top-0 bottom-0 w-1 bg-amber-400"></div>}
                    <div className={`mt-0.5 mr-4 flex-shrink-0 transition-colors ${checklist[id] ? 'text-emerald-600' : 'text-slate-300 group-hover:text-emerald-500'}`}>
                        {checklist[id] ? <Icons.CheckSquare size={24} /> : <Icons.Square size={24} />}
                    </div>
                    <div className="flex-1">
                        <div className="flex justify-between items-start">
                            <span className={`font-semibold text-lg ${checklist[id] ? 'text-emerald-900' : 'text-slate-800'}`}>{text}</span>
                            {checklist[id] && <span className="text-[10px] uppercase font-bold bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded tracking-wider flex items-center">Done <Icons.CheckCircle size={10} className="ml-1"/></span>}
                        </div>
                        {subtext && <p className={`text-sm mt-1 leading-relaxed ${checklist[id] ? 'text-emerald-700' : 'text-slate-500'}`}>{subtext}</p>}
                    </div>
                </div>
            );

            const PrintReport = () => (
                <div className="print-only p-8 max-w-4xl mx-auto">
                    <div className="border-b-2 border-[#006858] pb-4 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-900">{projectName || "Planning Project"}</h1>
                            <p className="text-slate-600 mt-2">Compliance & Validation Report</p>
                        </div>
                        <div className="text-right text-sm text-slate-500">
                            <p>Date: {new Date().toLocaleDateString()}</p>
                            <p className="font-bold text-[#006858] uppercase">
                                {authority === 'city' ? "Cork City" : authority === 'county' ? "Cork County" : authority === 'kerry' ? "Kerry County" : "Not Selected"}
                            </p>
                        </div>
                    </div>

                    <div className="space-y-6">
                        <div>
                            <h2 className="text-lg font-bold text-slate-800 border-b border-slate-200 pb-2 mb-3">1. Strategic Compliance</h2>
                            <ul className="space-y-2 text-sm">
                                <li className="flex items-center"><span className="mr-2">{checklist['strat_npf'] ? '✅' : '⚪'}</span> NPF Alignment</li>
                                {authority === 'city' ? (
                                    <>
                                        <li className="flex items-center"><span className="mr-2">{checklist['strat_zone_fav'] ? '✅' : '⚪'}</span> Zoning (ZO 1) Compliance</li>
                                        <li className="flex items-center"><span className="mr-2">{checklist['strat_services'] ? '✅' : '⚪'}</span> Services Availability</li>
                                    </>
                                ) : authority === 'kerry' ? (
                                    <>
                                         <li className="flex items-center"><span className="mr-2">{checklist['strat_kerry_settlement'] ? '✅' : '⚪'}</span> Kerry Settlement Policy</li>
                                         <li className="flex items-center"><span className="mr-2">{checklist['strat_kerry_landscape'] ? '✅' : '⚪'}</span> Amenity Area / Landscape Check</li>
                                    </>
                                ) : (
                                    <>
                                        <li className="flex items-center"><span className="mr-2">{checklist['strat_strong_urban'] ? '✅' : '⚪'}</span> Rural Policy Area Acknowledged</li>
                                        <li className="flex items-center"><span className="mr-2">{checklist['strat_ribbon'] ? '✅' : '⚪'}</span> Ribbon Development Check</li>
                                    </>
                                )}
                            </ul>
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-slate-800 border-b border-slate-200 pb-2 mb-3">2. Pre-Planning</h2>
                            <div className="grid grid-cols-2 gap-4 text-sm">
                                <div className="flex items-center"><span className="mr-2">{checklist['pp_map'] ? '✅' : '⚪'}</span> Location Map</div>
                                <div className="flex items-center"><span className="mr-2">{checklist['pp_layout'] ? '✅' : '⚪'}</span> Draft Layout</div>
                                <div className="flex items-center"><span className="mr-2">{checklist['pp_proof'] ? '✅' : '⚪'}</span> Proof of Interest</div>
                            </div>
                        </div>
                        <div>
                            <h2 className="text-lg font-bold text-slate-800 border-b border-slate-200 pb-2 mb-3">3. Application Assembly</h2>
                            <ul className="space-y-2 text-sm">
                                <li className="flex items-center"><span className="mr-2">{checklist['app_news'] ? '✅' : '⚪'}</span> Newspaper Notice</li>
                                <li className="flex items-center"><span className="mr-2">{checklist['app_submit'] ? '✅' : '⚪'}</span> Lodged within 14 Days</li>
                                <li className="flex items-center"><span className="mr-2">{checklist['app_fee_pd'] ? '✅' : '⚪'}</span> Fee Enclosed: <strong>€{calculatedFee.toFixed(2)}</strong></li>
                            </ul>
                        </div>
                        {generatedNotice && (
                            <div className="bg-slate-50 p-4 rounded border border-slate-200 mt-4">
                                <h3 className="text-xs font-bold text-slate-500 uppercase mb-2">Generated Notice Text</h3>
                                <p className="text-xs font-mono whitespace-pre-wrap">{generatedNotice}</p>
                            </div>
                        )}
                        {authority === 'kerry' && (
                             <div>
                                <h2 className="text-lg font-bold text-slate-800 border-b border-slate-200 pb-2 mb-3">4. Kerry Specifics</h2>
                                <ul className="space-y-2 text-sm">
                                    <li className="flex items-center"><span className="mr-2">{checklist['kerry_occupancy'] ? '✅' : '⚪'}</span> Occupancy Clause (7 Years) Accepted</li>
                                    <li className="flex items-center"><span className="mr-2">{checklist['kerry_gaeltacht'] ? '✅' : '⚪'}</span> Gaeltacht Requirements Checked</li>
                                </ul>
                             </div>
                        )}
                    </div>
                    <div className="mt-12 pt-8 border-t border-slate-300 text-center text-xs text-slate-400">
                        <p>Digital Solutions Developed by Dave Maher.</p>
                        <p className="mt-1 italic">Disclaimer: Planning legislation is subject to change. This tool is for guidance only.</p>
                    </div>
                </div>
            );

            // --- MAIN RENDER ---
            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="hse-gradient text-white pt-8 pb-20 px-6 no-print">
                        <div className="max-w-7xl mx-auto">
                            <nav className="flex justify-between items-center mb-12">
                                <div className="flex items-center gap-4">
                                    <div className="bg-white p-2 rounded-xl">
                                        <img src="https://www.esther.ie/wp-content/uploads/2022/05/HSE-Logo-Green-NEW-no-background.png" alt="HSE Logo" className="h-10"/>
                                    </div>
                                    <div className="border-l border-white/20 pl-4">
                                        <h1 className="text-xl font-extrabold tracking-tight">HSE Capital & Estates</h1>
                                        <p className="text-xs text-emerald-200 font-medium uppercase tracking-widest">Digital Infrastructure Hub</p>
                                    </div>
                                </div>
                                <div className="hidden md:block text-right">
                                    <p className="text-xs font-bold text-emerald-300 uppercase">Principal Developer</p>
                                    <p className="text-sm font-semibold">Dave Maher</p>
                                </div>
                            </nav>
                            <div className="w-full flex flex-col md:flex-row md:justify-between md:items-end gap-6">
                                <div className="flex-1">
                                    <h2 className="text-4xl md:text-5xl font-black mb-4 leading-tight">Planning Validation Tool</h2>
                                    <p className="text-emerald-100/80 text-lg leading-relaxed max-w-4xl">
                                        Compliance checklist, fee calculator, and workflow engine for Cork & Kerry development projects.
                                    </p>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => window.print()} className="flex items-center text-xs font-bold bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-50 border border-emerald-400/30 px-4 py-2 rounded-lg transition">
                                        <Icons.Printer size={16} className="mr-2"/> Print Report
                                    </button>
                                     <button onClick={exportData} className="flex items-center text-xs font-bold bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-50 border border-emerald-400/30 px-4 py-2 rounded-lg transition">
                                        <Icons.Save size={16} className="mr-2"/> Save
                                    </button>
                                    <button onClick={triggerImport} className="flex items-center text-xs font-bold bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-50 border border-emerald-400/30 px-4 py-2 rounded-lg transition">
                                        <Icons.Upload size={16} className="mr-2"/> Load
                                    </button>
                                    <input type="file" id="fileInput" className="hidden" accept=".json,text/plain" onChange={handleFileUpload} />
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-6 -mt-12 flex-1 w-full relative z-10 no-print">
                         <div className="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                            {/* Toolbar (Mobile Fixed) */}
                            <div className="border-b border-slate-100 p-4 bg-slate-50/50 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
                                <div className="flex items-center space-x-2">
                                    <span className="text-[10px] font-bold uppercase tracking-widest text-slate-400 bg-slate-100 px-2 py-1 rounded">Project</span>
                                    <input type="text" value={projectName} onChange={(e) => setProjectName(e.target.value)} className="font-bold text-slate-800 bg-transparent outline-none focus:border-b-2 focus:border-[#006858] transition-colors w-full sm:w-auto" />
                                </div>
                                <div className="text-xs font-medium text-slate-500">Step {currentStep + 1} of {steps.length}: <span className="text-[#006858] font-bold">{steps[currentStep].title}</span></div>
                            </div>

                            {/* Progress */}
                            <div className="w-full bg-slate-100 h-1"><div className="bg-[#006858] h-full transition-all duration-500 ease-out" style={{ width: `${((currentStep + 1) / steps.length) * 100}%` }} /></div>

                            <div className="p-8 animate-fadeIn min-h-[500px]">
                                {currentStep === 0 && (
                                    <div className="space-y-6">
                                        <div className="text-center mb-10"><h2 className="text-2xl font-bold text-slate-800 mb-2">Select Authority</h2><p className="text-slate-500 text-sm">Planning policy varies significantly by jurisdiction.</p></div>
                                        <div className="grid md:grid-cols-3 gap-6 max-w-6xl mx-auto">
                                            <button onClick={() => selectAuthority('city')} className="group p-8 rounded-2xl border-2 border-slate-100 hover:border-[#006858] hover:shadow-lg transition-all text-left bg-white">
                                                <div className="w-12 h-12 rounded-full bg-emerald-50 flex items-center justify-center text-[#006858] mb-4 group-hover:scale-110 transition-transform"><Icons.Building2 size={24}/></div>
                                                <h3 className="text-lg font-bold text-slate-900">Cork City Council</h3>
                                                <p className="text-sm text-slate-500 mt-2">Compact Growth, Zoning (ZO), Urban Density.</p>
                                            </button>
                                            <button onClick={() => selectAuthority('county')} className="group p-8 rounded-2xl border-2 border-slate-100 hover:border-[#006858] hover:shadow-lg transition-all text-left bg-white">
                                                <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 mb-4 group-hover:scale-110 transition-transform"><Icons.Trees size={24}/></div>
                                                <h3 className="text-lg font-bold text-slate-900">Cork County Council</h3>
                                                <p className="text-sm text-slate-500 mt-2">Rural Housing, Local Need, Agricultural Exemptions.</p>
                                            </button>
                                            <button onClick={() => selectAuthority('kerry')} className="group p-8 rounded-2xl border-2 border-slate-100 hover:border-emerald-600 hover:shadow-lg transition-all text-left bg-white">
                                                <div className="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 mb-4 group-hover:scale-110 transition-transform"><Icons.Mountain size={24}/></div>
                                                <h3 className="text-lg font-bold text-slate-900">Kerry County Council</h3>
                                                <p className="text-sm text-slate-500 mt-2">Landscape Protection, Gaeltacht, Amenity Areas.</p>
                                            </button>
                                        </div>
                                    </div>
                                )}
                                {currentStep === 1 && (
                                    <div className="max-w-4xl mx-auto space-y-6">
                                        <div className="text-center mb-6"><h3 className="text-xl font-bold text-slate-800">Strategic Compliance</h3></div>
                                        <CheckItem id="strat_npf" text="National Planning Framework" subtext={authority === 'city' ? "Supports Compact Growth / Brownfield?" : "Avoids Leapfrog Development?"} required />
                                        {authority === 'city' ? (
                                            <><CheckItem id="strat_zone_fav" text="Zoning Compliance" subtext="ZO 1 (Sustainable Residential) or similar?" required /><CheckItem id="strat_services" text="Services Availability" /></>
                                        ) : authority === 'kerry' ? (
                                            <><CheckItem id="strat_kerry_settlement" text="Settlement Policy (KCDP 5-13)" subtext="Rural housing only where genuine need exists." required />
                                            <CheckItem id="strat_kerry_landscape" text="Landscape Protection Check" subtext="Is site in 'Secondary' or 'Prime' Special Amenity Area?" />
                                            </>
                                        ) : (
                                            <><CheckItem id="strat_strong_urban" text="Rural Policy Area Status" required /><CheckItem id="strat_ribbon" text="Ribbon Development Check" /></>
                                        )}
                                        <div className="flex justify-end pt-6"><button onClick={handleNext} className="bg-[#006858] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#004d42] transition-colors shadow-lg shadow-emerald-900/10 flex items-center">Next <Icons.ChevronRight size={18} className="ml-2"/></button></div>
                                    </div>
                                )}
                                {currentStep === 2 && (
                                     <div className="max-w-5xl mx-auto">
                                        <h3 className="text-xl font-bold text-slate-800 mb-6 text-center">Project Type</h3>
                                        <div className="grid md:grid-cols-3 gap-4 mb-8">
                                            {['residential', 'agricultural', 'commercial'].map(type => (
                                                <button key={type} onClick={() => selectProject(type)} className={`p-6 rounded-xl border transition-all text-center ${projectType === type ? 'border-[#006858] bg-emerald-50/50' : 'border-slate-200 hover:border-emerald-300'}`}>
                                                    <div className="mx-auto mb-3 flex justify-center text-slate-400">{type === 'residential' ? <Icons.Home /> : type === 'agricultural' ? <Icons.Tractor /> : <Icons.Building2 />}</div>
                                                    <span className="font-bold text-sm block capitalize text-slate-700">{type}</span>
                                                </button>
                                            ))}
                                        </div>
                                        {projectType === 'residential' && <div className="bg-slate-50 p-6 rounded-xl border border-slate-200"><h4 className="font-bold text-sm uppercase text-slate-500 mb-4 tracking-wide">Exempted Dev Checklist</h4><div className="space-y-2"><CheckItem id="e1" text="Rear extension ≤ 40m²?" /><CheckItem id="e2" text="25m² garden remains?" /><CheckItem id="e3" text="Ground floor only?" /></div></div>}
                                        <div className="flex justify-between mt-8"><button onClick={handleBack} className="text-slate-500 font-bold text-sm hover:text-slate-800">Back</button><button onClick={handleNext} className="bg-[#006858] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#004d42] transition-colors shadow-lg shadow-emerald-900/10">Continue</button></div>
                                     </div>
                                )}
                                {currentStep === 3 && (
                                    <div className="max-w-4xl mx-auto space-y-6">
                                        <div className="flex items-center justify-between mb-4"><h3 className="text-xl font-bold text-slate-800">Pre-Planning (S.247)</h3><span className="bg-amber-100 text-amber-800 text-[10px] uppercase font-bold px-2 py-1 rounded">Mandatory</span></div>
                                        <CheckItem id="pp_map" text="Site Location Map" subtext="OSi License, Scale 1:1000/1:2500" required />
                                        <CheckItem id="pp_layout" text="Draft Site Layout" subtext="Building position, entrance, services" required />
                                        <CheckItem id="pp_proof" text="Proof of Interest" subtext="Folio or Letter of Consent" required />
                                        <div className="flex justify-between pt-6"><button onClick={handleBack} className="text-slate-500 font-bold text-sm hover:text-slate-800">Back</button> <div className="text-right">{validationError && <p className="text-red-600 text-sm font-bold mb-2">{validationError}</p>}<button onClick={handleNext} className="bg-[#006858] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#004d42]">Confirm & Next</button></div></div>
                                    </div>
                                )}
                                {currentStep === 4 && (
                                    <div className="max-w-7xl mx-auto grid lg:grid-cols-2 gap-8">
                                        <div className="space-y-6">
                                            <div className="bg-slate-50 p-6 rounded-xl border border-slate-200">
                                                <div className="flex items-center mb-4 text-[#006858]"><Icons.Calculator className="mr-2"/><h4 className="font-bold">Fee Calculator</h4></div>
                                                <div className="grid grid-cols-2 gap-2 mb-4">{['house', 'extension', 'commercial', 'ag'].map(cat => (<button key={cat} onClick={() => setFeeSettings({...feeSettings, category: cat})} className={`text-xs font-bold py-2 rounded uppercase ${feeSettings.category === cat ? 'bg-[#006858] text-white' : 'bg-white border text-slate-500'}`}>{cat}</button>))}</div>
                                                {feeSettings.category === 'house' && <input type="number" min="1" value={feeSettings.units} onChange={(e) => setFeeSettings({...feeSettings, units: parseInt(e.target.value)||0})} className="w-full p-2 border rounded mb-2" placeholder="Units" />}
                                                {feeSettings.category === 'commercial' && <input type="number" min="0" value={feeSettings.area} onChange={(e) => setFeeSettings({...feeSettings, area: parseFloat(e.target.value)||0})} className="w-full p-2 border rounded mb-2" placeholder="Area m²" />}
                                                <div className="flex justify-between items-center pt-2 border-t mt-2"><span className="text-sm font-bold text-slate-500">Total</span><span className="text-xl font-black text-[#006858]">€{calculatedFee}</span></div>
                                            </div>
                                            <div className="bg-slate-50 p-6 rounded-xl border border-slate-200">
                                                 <div className="flex items-center mb-4 text-blue-600"><Icons.PenTool className="mr-2"/><h4 className="font-bold">Newspaper & Site Notice Generator</h4></div>
                                                 <input className="w-full p-2 text-sm border rounded mb-2" placeholder="Applicant Name" value={noticeDetails.applicant} onChange={e => setNoticeDetails({...noticeDetails, applicant: e.target.value})}/>
                                                 <textarea className="w-full p-2 text-sm border rounded mb-2" placeholder="Site Address" rows="2" value={noticeDetails.address} onChange={e => setNoticeDetails({...noticeDetails, address: e.target.value})}/>
                                                 <textarea className="w-full p-2 text-sm border rounded mb-2" placeholder="Development Description" rows="3" value={noticeDetails.description} onChange={e => setNoticeDetails({...noticeDetails, description: e.target.value})}/>
                                                 
                                                 {noticeError && <p className="text-red-500 text-xs font-bold mb-2">{noticeError}</p>}
                                                 
                                                 <button onClick={generateNoticeText} className="w-full bg-blue-600 text-white py-2 rounded text-xs font-bold uppercase hover:bg-blue-700 transition">Generate Notice Text</button>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 className="font-bold text-slate-800 mb-4">Application Checks</h4>
                                            <div className="space-y-2">
                                                <CheckItem id="app_news" text="Newspaper Notice" required />
                                                <CheckItem id="app_submit" text="Lodged (14 Days)" required />
                                                <CheckItem id="app_site_notice" text="Site Notice Erected" required />
                                                <CheckItem id="app_fee_pd" text="Correct Fee Paid" required />
                                            </div>
                                            <div className="mt-8 flex justify-end">
                                                 <div className="text-right">{validationError && <p className="text-red-600 text-sm font-bold mb-2">{validationError}</p>}<button onClick={handleNext} className="bg-[#006858] text-white px-6 py-3 rounded-xl font-bold hover:bg-[#004d42]">Next Step</button></div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {currentStep === 5 && (
                                    <div className="max-w-2xl mx-auto space-y-6">
                                        <h3 className="text-xl font-bold text-slate-800 text-center">{authority === 'city' ? 'Urban Specifics' : authority === 'kerry' ? 'Kerry Specifics' : 'Rural Specifics'}</h3>
                                        {authority === 'city' ? (
                                            <div className="space-y-2"><CheckItem id="urb_density" text="Density Standards Met" /><CheckItem id="urb_partv_full" text="Part V Agreement" /></div>
                                        ) : authority === 'kerry' ? (
                                            <div className="space-y-2">
                                                <CheckItem id="kerry_occupancy" text="Occupancy Clause (7 Years)" required />
                                                <CheckItem id="kerry_gaeltacht" text="Gaeltacht Language Statement?" />
                                                <CheckItem id="kerry_design" text="Kerry Rural Design Guide Met?" />
                                            </div>
                                        ) : (
                                            <div className="space-y-2"><CheckItem id="rur_farmer" text="Local Need: Farmer" /><CheckItem id="rur_linked" text="Local Need: Linked" /><CheckItem id="rur_sec47" text="Section 47 Occupancy" required /></div>
                                        )}
                                        <div className="flex justify-between pt-6"><button onClick={handleBack} className="text-slate-500 font-bold text-sm">Back</button> <button onClick={handleNext} className="bg-[#006858] text-white px-6 py-3 rounded-xl font-bold">Next</button></div>
                                    </div>
                                )}
                                {currentStep === 6 && (
                                    <div className="max-w-2xl mx-auto text-center space-y-8">
                                        <div className="bg-emerald-50 p-8 rounded-full w-32 h-32 mx-auto flex items-center justify-center text-[#006858]"><Icons.CheckCircle size={64}/></div>
                                        <div><h2 className="text-3xl font-black text-slate-900 mb-2">Ready to Lodge</h2><p className="text-slate-500">Ensure post-grant compliance steps are noted.</p></div>
                                        <div className="bg-slate-50 p-6 rounded-xl border border-slate-200 text-left space-y-2">
                                            <CheckItem id="con_contrib" text="Development Contributions" required />
                                            <CheckItem id="con_bcms" text="Commencement Notice (BCMS)" required />
                                        </div>
                                        <div className="flex justify-center pt-4"><button onClick={() => window.print()} className="bg-slate-900 text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-800 flex items-center"><Icons.Printer size={18} className="mr-2"/> Print Final Report</button></div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="mt-20 border-t border-slate-200 bg-white py-12 px-6 no-print">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
                            <div>
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-6 h-6 bg-[#006858] rounded flex items-center justify-center"><img src="https://assets.hse.ie/static/hse-frontend/assets/favicons/favicon.ico" className="w-4 h-4 brightness-0 invert" alt=""/></div>
                                    <span className="font-extrabold text-slate-800">HSE Capital & Estates</span>
                                </div>
                                <p className="text-xs text-slate-500">&copy; 2026 Health Service Executive. All rights reserved.</p>
                            </div>
                            <div className="text-center md:text-right">
                                <p className="text-sm font-bold text-slate-700">Digital Solutions Developed by Dave Maher</p>
                                <p className="text-[10px] text-slate-400 mt-1 uppercase tracking-widest font-medium">Disclaimer: Planning regulations subject to change. Guidance only.</p>
                            </div>
                        </div>
                    </footer>

                    <PrintReport />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PlanningCalculator />);
    </script>
</body>
</html>


