<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HSE Aspergillus Control Assessment Tool</title>
  
  <!-- Favicons -->
  <link rel="icon" href="https://assets.hse.ie/static/hse-frontend/assets/favicons/favicon.ico">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Print Specific Styles */
    @media print {
      @page { 
        size: A4 landscape; 
        margin: 10mm;
      }
      
      body { 
        background-color: #ffffff !important; 
        color: #000 !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      /* Hide interactive elements */
      .no-print, header button, .input-field, input[type="text"], input[type="date"], select, button { display: none !important; }
      .print-only { display: block !important; }
      
      /* Ensure Main Container Fits */
      main {
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
      }
      
      /* Force backgrounds */
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

      /* Hide layout columns that are input-only */
      .input-column { display: none !important; }
      .report-column { width: 100% !important; grid-column: span 12 !important; }
    }
    
    .print-only { display: none; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- ICONS (Embedded SVGs to replace lucide-react) ---
    const IconBase = ({ children, className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
    );

    const ClipboardList = (props) => <IconBase {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></IconBase>;
    const MapPin = (props) => <IconBase {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
    const User = (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
    const Calendar = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>;
    const ShieldAlert = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></IconBase>;
    const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
    const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>;
    const Wind = (props) => <IconBase {...props}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></IconBase>;
    const Thermometer = (props) => <IconBase {...props}><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></IconBase>;
    const Printer = (props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></IconBase>;
    const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
    const Building2 = (props) => <IconBase {...props}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></IconBase>;
    const Stethoscope = (props) => <IconBase {...props}><path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/><path d="M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"/><circle cx="20" cy="10" r="2"/></IconBase>;
    const Activity = (props) => <IconBase {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconBase>;
    const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>;
    const MousePointer2 = (props) => <IconBase {...props}><path d="m12 12-4.5 9L11 23l2-7 7-2-9-4.5Z"/></IconBase>;
    const AlertOctagon = (props) => <IconBase {...props}><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y2="16"/></IconBase>;

    // --- SHARED COMPONENTS ---

    const Card = ({ children, className = "" }) => (
      <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${className}`}>
        {children}
      </div>
    );

    const SectionHeader = ({ title, icon: Icon, color = "text-emerald-800" }) => (
      <div className={`flex items-center gap-2 mb-4 pb-2 border-b border-slate-100 ${color}`}>
        {Icon && <Icon className="w-5 h-5" />}
        <h3 className="font-bold text-slate-800 uppercase tracking-tight text-sm">{title}</h3>
      </div>
    );

    const Badge = ({ children, color = "bg-slate-100 text-slate-600" }) => (
      <span className={`px-2 py-0.5 rounded text-[10px] font-black uppercase tracking-widest ${color}`}>
        {children}
      </span>
    );

    const CheckItem = ({ label }) => (
      <li className="flex items-start gap-2">
        <CheckCircle className="w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0" />
        <span>{label}</span>
      </li>
    );

    const DecisionRow = ({ label, value, setValue, size = "md" }) => (
      <div className={`flex items-center justify-between ${size === 'sm' ? 'text-xs' : 'text-sm'}`}>
        <span className="font-bold text-slate-700">{label}</span>
        <div className="flex bg-slate-100 p-1 rounded-lg no-print">
          <button 
            onClick={() => setValue('yes')}
            className={`px-3 py-1 rounded font-bold transition-all ${value === 'yes' ? 'bg-white shadow text-emerald-700' : 'text-slate-400 hover:text-slate-600'}`}
          >
            YES
          </button>
          <button 
            onClick={() => setValue('no')}
            className={`px-3 py-1 rounded font-bold transition-all ${value === 'no' ? 'bg-white shadow text-red-700' : 'text-slate-400 hover:text-slate-600'}`}
          >
            NO
          </button>
        </div>
        {/* Print Only Representation of Decision */}
        <div className="print-only text-xs font-bold">
            {value ? value.toUpperCase() : 'PENDING'}
        </div>
      </div>
    );

    const SuccessBox = ({ title, children }) => (
      <div className="bg-emerald-50 border border-emerald-100 rounded-lg p-4 flex gap-3 items-start">
        <CheckCircle className="w-5 h-5 text-emerald-600 mt-0.5" />
        <div>
          <h4 className="font-bold text-emerald-900 text-sm">{title}</h4>
          <p className="text-xs text-emerald-800 mt-1">{children}</p>
        </div>
      </div>
    );

    const ActionBox = ({ children, color }) => (
      <div className={`p-3 rounded-lg text-xs font-bold uppercase tracking-wide text-center border ${color}`}>
        {children}
      </div>
    );

    const SummaryLine = ({ label, value, highlight }) => (
      <div className="flex justify-between border-b border-slate-100 pb-1 mb-1">
        <span className="text-slate-500 uppercase font-bold text-[10px] tracking-wider">{label}</span>
        <span className={`font-bold ${highlight ? 'text-emerald-700' : 'text-slate-700'}`}>{value}</span>
      </div>
    );

    // --- LOGIC DATA ---

    const riskGroups = [
      { id: 1, label: 'Group 1: No Risk', description: 'Office areas, non-patient areas.' },
      { id: 2, label: 'Group 2: Increased Risk', description: 'General wards, outpatient areas.' },
      { id: 3, label: 'Group 3: High Risk', description: 'ICU, Oncology, Surgery, Burn units.' },
      { id: 4, label: 'Group 4: Very High Risk', description: 'Transplant units, Sterile processing.' },
    ];

    const constructionTypes = [
      { id: 'A1', label: 'Type A1: Minor Internal', description: 'Inspection, non-invasive.' },
      { id: 'A2', label: 'Type A2: Minor Small', description: 'Small scale, short duration, minimal dust.' },
      { id: 'B',  label: 'Type B: Minor/Medium', description: 'Moderate dust, cutting walls, cabling.' },
      { id: 'C',  label: 'Type C: Major Internal', description: 'Demolition, removal of ceiling tiles.' },
      { id: 'D',  label: 'Type D: Major External', description: 'Excavation, heavy machinery.' },
    ];

    const riskMatrix = {
      1: { 'A1': '0', 'A2': 'I', 'B': 'I',  'C': 'III', 'D': 'III' },
      2: { 'A1': '0', 'A2': 'I', 'B': 'II', 'C': 'III', 'D': 'III' },
      3: { 'A1': 'I', 'A2': 'I', 'B': 'II', 'C': 'III', 'D': 'III' },
      4: { 'A1': 'I', 'A2': 'I', 'B': 'II', 'C': 'III', 'D': 'III' },
    };

    // --- MAIN APP ---

    function AspergillusControlApp() {
      // --- STATE ---
      
      // Project Details
      const [details, setDetails] = useState({
        name: '',
        location: '',
        assessor: '',
        date: new Date().toISOString().split('T')[0],
        consultedIPC: false
      });

      // Assessment Inputs
      const [selectedGroup, setSelectedGroup] = useState(null);
      const [selectedType, setSelectedType] = useState(null);
      
      // Calculated State
      const [riskClass, setRiskClass] = useState(null);
      
      // Workflow Decisions
      const [relocatePatients, setRelocatePatients] = useState(null);
      const [coolingRequired, setCoolingRequired] = useState(null);
      const [internalCooling, setInternalCooling] = useState(null);
      const [ductedCamfills, setDuctedCamfills] = useState(null);
      const [ductedAC, setDuctedAC] = useState(null);

      // --- EFFECT: CALCULATION ENGINE ---
      useEffect(() => {
        if (selectedGroup && selectedType) {
          let result = riskMatrix[selectedGroup][selectedType];
          if (result === '0' && (selectedGroup === 3 || selectedGroup === 4)) {
             result = 'I'; // Safety override per chart logic
          }
          setRiskClass(result);
        } else {
          setRiskClass(null);
        }
      }, [selectedGroup, selectedType]);

      // Reset workflow if upstream inputs change
      useEffect(() => {
        setRelocatePatients(null);
        setCoolingRequired(null);
        setInternalCooling(null);
        setDuctedCamfills(null);
        setDuctedAC(null);
      }, [riskClass]);

      // --- ACTIONS ---

      const handlePrint = () => window.print();

      const handleSave = () => {
        const data = {
          projectDetails: details,
          inputs: { selectedGroup, selectedType },
          results: { riskClass },
          workflow: { relocatePatients, coolingRequired, internalCooling, ductedCamfills, ductedAC },
          meta: { createdBy: "Dave Maher", date: new Date().toISOString() }
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `${details.name.replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'aspergillus'}_risk_assessment.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      const getResultColor = (cls) => {
        if (cls === 'III' || cls === 'IV') return 'bg-red-900 text-white';
        if (cls === 'II') return 'bg-orange-600 text-white';
        return 'bg-emerald-600 text-white';
      };

      return (
        <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-20 print:pb-0 print:bg-white">
          
          {/* HEADER */}
          <header className="bg-emerald-900 text-white p-4 shadow-md sticky top-0 z-50 print:hidden">
            <div className="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
              <div className="flex items-center gap-4">
                <div className="bg-white p-1.5 rounded-lg shadow-sm">
                  <img src="https://www.esther.ie/wp-content/uploads/2022/05/HSE-Logo-Green-NEW-no-background.png" alt="HSE Logo" className="h-8 w-auto" />
                </div>
                <div>
                  <h1 className="text-xl font-bold tracking-tight">Infection Control Risk Tool</h1>
                  <div className="flex gap-2">
                     <Badge color="bg-emerald-800 text-emerald-100">Aspergillus Control</Badge>
                     <Badge color="bg-emerald-700 text-emerald-100">Dave Maher</Badge>
                  </div>
                </div>
              </div>
              
              <div className="flex gap-3 w-full md:w-auto">
                <input 
                  type="text" 
                  placeholder="Project Name..." 
                  value={details.name}
                  onChange={(e) => setDetails({...details, name: e.target.value})}
                  className="px-3 py-1.5 rounded text-slate-800 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 bg-white/90 w-full md:w-64"
                />
                <button onClick={handleSave} className="flex items-center gap-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded text-sm font-medium transition-colors">
                  <Save className="w-4 h-4" /> Save
                </button>
                <button onClick={handlePrint} className="flex items-center gap-2 px-3 py-1.5 bg-white text-emerald-900 hover:bg-emerald-50 rounded text-sm font-bold transition-colors shadow-sm">
                  <Printer className="w-4 h-4" /> Print
                </button>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto p-4 md:p-6">
            
            {/* PRINT ONLY HEADER */}
            <div className="hidden print:flex justify-between items-start mb-8 border-b-4 border-emerald-600 pb-4">
               <div className="flex items-center gap-6">
                  <img src="https://www.esther.ie/wp-content/uploads/2022/05/HSE-Logo-Green-NEW-no-background.png" alt="HSE Logo" className="h-16 w-auto" />
                  <div>
                     <h1 className="text-3xl font-black text-slate-800 uppercase tracking-tight">Aspergillus Risk Assessment</h1>
                     <p className="text-sm font-bold text-slate-500 uppercase tracking-widest">{details.name || 'Draft Assessment'}</p>
                  </div>
               </div>
               <div className="text-right">
                  <p className="text-xs font-black text-slate-400 uppercase">Date</p>
                  <p className="text-lg font-bold">{new Date().toLocaleDateString('en-GB')}</p>
               </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
              
              {/* LEFT COLUMN: INPUTS */}
              <div className="lg:col-span-4 space-y-6 input-column">
                
                <Card className="p-5">
                  <SectionHeader title="Project Details" icon={Building2} />
                  <div className="space-y-4">
                    <div>
                      <label className="label-text">Location / Ward</label>
                      <input type="text" className="input-field" value={details.location} onChange={(e) => setDetails({...details, location: e.target.value})} placeholder="e.g. Ward 2B" />
                    </div>
                    <div>
                      <label className="label-text">Assessor</label>
                      <input type="text" className="input-field" value={details.assessor} onChange={(e) => setDetails({...details, assessor: e.target.value})} placeholder="Name" />
                    </div>
                    <div>
                      <label className="label-text">Date</label>
                      <input type="date" className="input-field" value={details.date} onChange={(e) => setDetails({...details, date: e.target.value})} />
                    </div>
                    <div className="bg-emerald-50 p-3 rounded-lg border border-emerald-100">
                      <label className="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked={details.consultedIPC} onChange={(e) => setDetails({...details, consultedIPC: e.target.checked})} className="w-4 h-4 text-emerald-600 rounded" />
                        <span className="text-xs font-bold text-emerald-800 uppercase">IPC Team Consulted?</span>
                      </label>
                    </div>
                  </div>
                </Card>

                <Card className="p-5">
                  <SectionHeader title="Risk Matrix Inputs" icon={Activity} />
                  <div className="space-y-5">
                    <div>
                      <label className="label-text">1. Patient Risk Group</label>
                      <div className="space-y-2 mt-2">
                        {riskGroups.map(g => (
                          <button 
                            key={g.id} 
                            onClick={() => setSelectedGroup(g.id)}
                            className={`w-full text-left p-2.5 rounded-lg border text-xs transition-all ${selectedGroup === g.id ? 'bg-emerald-600 text-white border-emerald-700 shadow-md ring-2 ring-emerald-200' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50'}`}
                          >
                            <div className="font-bold uppercase">{g.label.split(':')[0]}</div>
                            <div className={`opacity-90 ${selectedGroup === g.id ? 'text-emerald-50' : 'text-slate-400'}`}>{g.description}</div>
                          </button>
                        ))}
                      </div>
                    </div>

                    <div>
                      <label className="label-text">2. Construction Activity</label>
                      <div className="space-y-2 mt-2">
                        {constructionTypes.map(t => (
                          <button 
                            key={t.id} 
                            onClick={() => setSelectedType(t.id)}
                            className={`w-full text-left p-2.5 rounded-lg border text-xs transition-all ${selectedType === t.id ? 'bg-blue-600 text-white border-blue-700 shadow-md ring-2 ring-blue-200' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50'}`}
                          >
                             <div className="font-bold uppercase">{t.label.split(':')[0]}</div>
                             <div className={`opacity-90 ${selectedType === t.id ? 'text-blue-50' : 'text-slate-400'}`}>{t.description}</div>
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>
                </Card>
              </div>

              {/* RIGHT COLUMN: REPORT & WORKFLOW */}
              <div className="lg:col-span-8 report-column space-y-6">
                
                {/* Risk Class Banner */}
                {riskClass ? (
                  <div className={`p-6 rounded-2xl shadow-lg flex flex-col md:flex-row justify-between items-center ${getResultColor(riskClass)}`}>
                    <div>
                      <span className="text-xs font-black uppercase tracking-widest opacity-60 mb-1">Calculated Risk Level</span>
                      <div className="text-4xl font-black tracking-tight flex items-center gap-3">
                        <ShieldAlert className="w-10 h-10 opacity-80" />
                        CLASS {riskClass}
                      </div>
                      <div className="text-xs font-bold opacity-80 mt-1">Based on Group {selectedGroup} + Activity Type {selectedType}</div>
                    </div>
                    <div className="mt-4 md:mt-0 bg-white/10 p-4 rounded-lg backdrop-blur-sm border border-white/20 max-w-xs text-xs font-medium no-print">
                      Use the workflow below to determine specific engineering controls.
                    </div>
                  </div>
                ) : (
                  <div className="bg-slate-100 border-2 border-dashed border-slate-200 rounded-2xl p-8 text-center text-slate-400 no-print">
                    <Stethoscope className="w-12 h-12 mx-auto mb-2 opacity-50" />
                    <p className="font-bold">Select Risk Group & Activity to Begin</p>
                  </div>
                )}

                {/* Workflow Dashboard */}
                {riskClass && (
                  <div className="space-y-6">
                    
                    {/* 1. Procedural Checks */}
                    <Card className="p-6 border-l-4 border-l-blue-500">
                      <SectionHeader title="Procedural Requirements" icon={ClipboardList} color="text-blue-700" />
                      <ul className="grid md:grid-cols-2 gap-3 text-sm text-slate-700">
                         <CheckItem label={`Identify Preventative Measures (Class ${riskClass})`} />
                         <CheckItem label="Identify Monitoring Locations & Freq." />
                         <CheckItem label="Clarify Indoor Dust Monitoring Needs" />
                         <CheckItem label="Carry Out Baseline Samples" />
                      </ul>
                    </Card>

                    {/* 2. Interactive Decision Tree */}
                    <Card className="p-6 border-l-4 border-l-amber-500">
                      <SectionHeader title="Control Measures Workflow" icon={AlertOctagon} color="text-amber-700" />
                      
                      <div className="space-y-6">
                        {/* Q1 Relocation */}
                        <DecisionRow 
                          label="Can patients in Groups 2-4 be relocated?"
                          value={relocatePatients}
                          setValue={setRelocatePatients}
                        />

                        {relocatePatients === 'yes' && (
                           <SuccessBox title="Issue Resolved">
                             No further engineering controls required in this specific zone if patients are removed.
                           </SuccessBox>
                        )}

                        {relocatePatients === 'no' && (
                          <div className="space-y-6 pl-4 border-l-2 border-slate-100 animate-in fade-in slide-in-from-top-2">
                             
                             {/* Ventilation Section */}
                             <div className="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <h4 className="flex items-center gap-2 font-bold text-slate-700 text-sm mb-3">
                                   <Wind className="w-4 h-4 text-slate-500" /> Ventilation Controls
                                </h4>
                                <ul className="text-xs text-slate-600 space-y-1 mb-4 pl-6 list-disc">
                                   <li>Seal windows, trickle vents, intakes & exhausts.</li>
                                   <li>Check nearby AHUs. Change to HEPA in high risk locations.</li>
                                   <li>Increase AHU inspection frequency.</li>
                                </ul>
                                
                                <DecisionRow 
                                  label="Can Ducted Camfils be used?" 
                                  value={ductedCamfills} 
                                  setValue={setDuctedCamfills} 
                                  size="sm"
                                />
                                
                                {ductedCamfills === 'yes' && <ActionBox color="bg-emerald-100 text-emerald-800 border-emerald-200">Action: Install & activate Camfils immediately.</ActionBox>}
                                {ductedCamfills === 'no' && (
                                  <div className="mt-3 space-y-2">
                                    <div className="text-[10px] text-slate-500 italic bg-white p-2 rounded border border-slate-100">
                                       Note: Room air HEPA units (fixed/portable) not recommended for long-term Group 3-4 use.
                                    </div>
                                    <ActionBox color="bg-red-100 text-red-800 border-red-200">DEPLOY TAFU (Tempered Air Filtration Units)</ActionBox>
                                  </div>
                                )}
                             </div>

                             {/* Cooling Section */}
                             <div className="bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <h4 className="flex items-center gap-2 font-bold text-slate-700 text-sm mb-3">
                                   <Thermometer className="w-4 h-4 text-slate-500" /> Cooling Requirements
                                </h4>
                                
                                <DecisionRow label="Is Cooling Required?" value={coolingRequired} setValue={setCoolingRequired} size="sm" />
                                
                                {coolingRequired === 'no' && <div className="mt-2 text-xs font-bold text-slate-400 ml-2">- No action needed</div>}
                                
                                {coolingRequired === 'yes' && (
                                   <div className="mt-3 pl-4 border-l-2 border-slate-200 space-y-3">
                                      <DecisionRow label="Internal cooling in place?" value={internalCooling} setValue={setInternalCooling} size="sm" />
                                      
                                      {internalCooling === 'yes' && <div className="text-xs font-bold text-emerald-600">- Monitor existing system.</div>}
                                      
                                      {internalCooling === 'no' && (
                                         <>
                                            <div className="text-xs bg-white p-2 border border-slate-200 rounded text-slate-600">Action: Install Solar Guard on windows.</div>
                                            <DecisionRow label="Consider Ducted A/C?" value={ductedAC} setValue={setDuctedAC} size="sm" />
                                            
                                            {ductedAC === 'yes' && <ActionBox color="bg-emerald-100 text-emerald-800 border-emerald-200">Action: Install Ducted A/C Units.</ActionBox>}
                                            {ductedAC === 'no' && <ActionBox color="bg-red-100 text-red-800 border-red-200">DEPLOY TAFU UNITS</ActionBox>}
                                         </>
                                      )}
                                   </div>
                                )}
                             </div>

                          </div>
                        )}
                      </div>
                    </Card>

                    {/* Final Summary Card */}
                    <Card className="p-6 bg-slate-50 border-slate-100">
                       <SectionHeader title="Assessment Summary" icon={FileText} />
                       <div className="text-xs space-y-2">
                          <SummaryLine label="Project" value={details.name} />
                          <SummaryLine label="Location" value={details.location} />
                          <SummaryLine label="Risk Class" value={`Class ${riskClass}`} highlight />
                          <SummaryLine label="IPC Status" value={details.consultedIPC ? "Consulted" : "Pending"} />
                          <div className="pt-2 border-t border-slate-200 mt-2"></div>
                          <SummaryLine label="Outcome" value={
                            relocatePatients === 'yes' ? 'Issue Resolved (Relocation)' :
                            (ductedCamfills === 'no' || (coolingRequired === 'yes' && internalCooling === 'no' && ductedAC === 'no')) ? 'TAFU DEPLOYMENT REQUIRED' :
                            'Standard Engineering Controls'
                          } highlight={relocatePatients === 'no'} />
                       </div>
                    </Card>
                  </div>
                )}

                {/* Signature Block (Print Only) */}
                <div className="hidden print:block mt-12 pt-8 border-t border-slate-200">
                   <div className="grid grid-cols-2 gap-12">
                      <div>
                         <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-8">Authorised By</p>
                         <div className="h-px bg-slate-300 w-full"></div>
                      </div>
                      <div className="text-right">
                         <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Created By</p>
                         <p className="text-sm font-bold text-slate-800">Dave Maher</p>
                         <p className="text-[10px] text-slate-400 uppercase mt-1">HSE Infection Control</p>
                      </div>
                   </div>
                </div>

              </div>
            </div>
            
            {/* FOOTER */}
            <footer className="mt-12 text-center text-slate-400 print:hidden">
               <p className="text-xs font-medium">Created by Dave Maher &copy; 2026</p>
               <p className="text-[10px] mt-1 opacity-60">HSE Infection Prevention & Control Framework</p>
            </footer>

          </main>

          <style>{`
            .label-text { display: block; font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 0.25rem; }
            .input-field { width: 100%; padding: 0.5rem; font-size: 0.875rem; border: 1px solid #e2e8f0; border-radius: 0.375rem; outline: none; transition: border-color 0.2s; }
            .input-field:focus { border-color: #10b981; box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1); }
            @media print {
              body { background: white; }
              .print\\:hidden { display: none !important; }
              .print\\:block { display: block !important; }
              .print\\:bg-white { background-color: white !important; }
            }
          `}</style>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AspergillusControlApp />);
  </script>
</body>
</html>


