<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HSE Optimism Bias Calculator</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Custom styles */
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    
    /* Slider Styling */
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 16px;
      width: 16px;
      border-radius: 50%;
      background: currentColor;
      cursor: pointer;
      margin-top: -6px; 
    }
    input[type=range]::-moz-range-thumb {
      height: 16px;
      width: 16px;
      border-radius: 50%;
      background: currentColor;
      cursor: pointer;
      border: none;
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: #e2e8f0;
      border-radius: 2px;
    }

    /* Print Styling */
    @media print {
      @page { size: A4; margin: 1.5cm; }
      body { background-color: white; color: black; font-size: 12pt; }
      header, .no-print { display: none !important; }
      .print-break-inside-avoid { break-inside: avoid; }
      .print-shadow-none { box-shadow: none !important; border: 1px solid #ccc !important; }
      main { padding: 0 !important; max-width: 100% !important; }
      .print-visible { display: block !important; margin-bottom: 20px; }
      .page-break { page-break-before: always; }
      
      /* Hide sliders in print, just show values */
      input[type=range] { display: none; }
      .mitigation-value { display: block !important; font-weight: bold; }
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>
  
  <!-- Placeholder for Saved State -->
  <script id="saved-state">window.SAVED_STATE = null;</script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // --- ICONS ---
    const Icon = ({ path, className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {path}
      </svg>
    );

    const Icons = {
      Calculator: (props) => <Icon {...props} path={<><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></>} />,
      TrendingUp: (props) => <Icon {...props} path={<><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></>} />,
      AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></>} />,
      Settings2: (props) => <Icon {...props} path={<><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></>} />,
      Calendar: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />,
      Euro: (props) => <Icon {...props} path={<><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2"/></>} />,
      BarChart3: (props) => <Icon {...props} path={<><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></>} />,
      ChevronRight: (props) => <Icon {...props} path={<><path d="m9 18 6-6-6-6"/></>} />,
      Info: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />,
      CheckSquare: (props) => <Icon {...props} path={<><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></>} />,
      Square: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="3" rx="2"/></>} />,
      Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
      Briefcase: (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></>} />,
      HardHat: (props) => <Icon {...props} path={<><path d="M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z"/><path d="M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5"/><path d="M4 15v-3a6 6 0 0 1 6-6h0"/><path d="M14 6h0a6 6 0 0 1 6 6v3"/></>} />,
      Monitor: (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="3" rx="2" ry="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></>} />,
      Printer: (props) => <Icon {...props} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></>} />,
      Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />,
    };

    // --- DATA CONFIGURATION ---
    const CATEGORIES = {
      buildings: {
        id: 'buildings',
        name: 'Buildings Projects',
        icon: Icons.Briefcase,
        types: [
          { id: 'standard', label: 'Standard Buildings' },
          { id: 'ns', label: 'Non-Standard Buildings' },
          { id: 'combined', label: 'Combined' }
        ],
        upper: {
          ns: { duration: 39, capex: 51 },
          s: { duration: 4, capex: 24 }
        },
        factors: {
          'procurement': [
            { name: 'Complexity of Contract Structure', ns: { d: 3, c: 1 }, s: { d: 1, c: 0 } },
            { name: 'Late Contractor Involvement in Design', ns: { d: 6, c: 2 }, s: { d: 3, c: 2 } },
            { name: 'Poor Contractor Capabilities', ns: { d: 5, c: 5 }, s: { d: 4, c: 9 } },
            { name: 'Government Guidelines', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Dispute & Claims Occurred', ns: { d: 5, c: 11 }, s: { d: 4, c: 29 } },
            { name: 'Information Management', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } }
          ],
          'project_specific': [
            { name: 'Design Complexity', ns: { d: 2, c: 3 }, s: { d: 3, c: 1 } },
            { name: 'Degree of Innovation', ns: { d: 8, c: 9 }, s: { d: 1, c: 4 } },
            { name: 'Environmental Impact', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 5, c: 5 }, s: { d: 0, c: 0 } }
          ],
          'client_specification': [
            { name: 'Inadequacy of the Business Case', ns: { d: 22, c: 23 }, s: { d: 31, c: 34 } },
            { name: 'Large No. of Stakeholders', ns: { d: 0, c: 0 }, s: { d: 6, c: 0 } },
            { name: 'Funding Availability', ns: { d: 3, c: 0 }, s: { d: 8, c: 0 } },
            { name: 'Project Management Team', ns: { d: 5, c: 2 }, s: { d: 0, c: 1 } },
            { name: 'Poor Project Intelligence', ns: { d: 5, c: 6 }, s: { d: 6, c: 2 } },
            { name: 'Other', ns: { d: 1, c: 2 }, s: { d: 0, c: 0 } }
          ],
          'environment': [
            { name: 'Public Relations', ns: { d: 0, c: 0 }, s: { d: 8, c: 2 } },
            { name: 'Site Characteristics', ns: { d: 3, c: 1 }, s: { d: 5, c: 2 } },
            { name: 'Permits / Consents / Approvals', ns: { d: 3, c: 0 }, s: { d: 9, c: 0 } },
            { name: 'Other', ns: { d: 1, c: 3 }, s: { d: 0, c: 0 } }
          ],
          'external_influences': [
            { name: 'Political', ns: { d: 13, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Economic', ns: { d: 0, c: 13 }, s: { d: 0, c: 11 } },
            { name: 'Legislation / Regulations', ns: { d: 6, c: 7 }, s: { d: 9, c: 3 } },
            { name: 'Technology', ns: { d: 4, c: 5 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 2 }, s: { d: 0, c: 0 } }
          ]
        }
      },
      civil: {
        id: 'civil',
        name: 'Civil Engineering',
        icon: Icons.HardHat,
        types: [
          { id: 'standard', label: 'Standard Civil Eng' },
          { id: 'ns', label: 'Non-Standard Civil Eng' },
          { id: 'combined', label: 'Combined' }
        ],
        upper: {
          ns: { duration: 18.5, capex: 50 },  // Updated based on user request
          s: { duration: 18.2, capex: 40.5 } // Updated based on user request
        },
        factors: {
          'procurement': [
            { name: 'Complexity of Contract Structure', ns: { d: 4, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Late Contractor Involvement in Design', ns: { d: 1, c: 0 }, s: { d: 0, c: 3 } },
            { name: 'Poor Contractor Capabilities', ns: { d: 2, c: 0 }, s: { d: 16, c: 0 } },
            { name: 'Government Guidelines', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Dispute & Claims Occurred', ns: { d: 4, c: 6 }, s: { d: 3, c: 14 } },
            { name: 'Information Management', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } }
          ],
          'project_specific': [
            { name: 'Design Complexity', ns: { d: 5, c: 3 }, s: { d: 4, c: 2 } },
            { name: 'Degree of Innovation', ns: { d: 2, c: 4 }, s: { d: 0, c: 6 } },
            { name: 'Environmental Impact', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 2, c: 4 }, s: { d: 0, c: 0 } }
          ],
          'client_specification': [
            { name: 'Inadequacy of the Business Case', ns: { d: 12, c: 30 }, s: { d: 36, c: 49 } },
            { name: 'Large No. of Stakeholders', ns: { d: 0, c: 0 }, s: { d: 6, c: 0 } },
            { name: 'Funding Availability', ns: { d: 2, c: 0 }, s: { d: 8, c: 0 } },
            { name: 'Project Management Team', ns: { d: 5, c: 2 }, s: { d: 0, c: 2 } },
            { name: 'Poor Project Intelligence', ns: { d: 5, c: 11 }, s: { d: 7, c: 5 } },
            { name: 'Other', ns: { d: 1, c: 2 }, s: { d: 0, c: 0 } }
          ],
          'environment': [
            { name: 'Public Relations', ns: { d: 0, c: 0 }, s: { d: 0, c: 9 } },
            { name: 'Site Characteristics', ns: { d: 0, c: 5 }, s: { d: 10, c: 3 } },
            { name: 'Permits / Consents / Approvals', ns: { d: 2, c: 0 }, s: { d: 10, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 1 }, s: { d: 0, c: 0 } }
          ],
          'external_influences': [
            { name: 'Political', ns: { d: 19, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Economic', ns: { d: 24, c: 20 }, s: { d: 0, c: 7 } },
            { name: 'Legislation / Regulations', ns: { d: 6, c: 12 }, s: { d: 0, c: 0 } },
            { name: 'Technology', ns: { d: 4, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } }
          ]
        }
      },
      equip: {
        id: 'equip',
        name: 'Equip/Dev & Outsource',
        icon: Icons.Monitor,
        types: [
          { id: 'ns', label: 'Equipment / Development' },
          { id: 'standard', label: 'Outsourcing' }
        ],
        upper: {
          ns: { duration: 54, capex: 200 },
          s: { duration: 0, capex: 41 }
        },
        factors: {
          'procurement': [
            { name: 'Complexity of Contract Structure', ns: { d: 13, c: 7 }, s: { d: 0, c: 0 } },
            { name: 'Late Contractor Involvement in Design', ns: { d: 0, c: 7 }, s: { d: 0, c: 0 } },
            { name: 'Poor Contractor Capabilities', ns: { d: 11, c: 4 }, s: { d: 0, c: 0 } },
            { name: 'Government Guidelines', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Dispute & Claims Occurred', ns: { d: 24, c: 18 }, s: { d: 0, c: 0 } },
            { name: 'Information Management', ns: { d: 0, c: 0 }, s: { d: 0, c: 23 } },
            { name: 'Other', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } }
          ],
          'project_specific': [
            { name: 'Design Complexity', ns: { d: 12, c: 13 }, s: { d: 0, c: 0 } },
            { name: 'Degree of Innovation', ns: { d: 15, c: 23 }, s: { d: 0, c: 37 } },
            { name: 'Environmental Impact', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 5, c: 8 }, s: { d: 0, c: 0 } }
          ],
          'client_specification': [
            { name: 'Inadequacy of the Business Case', ns: { d: 0, c: 6 }, s: { d: 0, c: 12 } },
            { name: 'Large No. of Stakeholders', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Funding Availability', ns: { d: 5, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Project Management Team', ns: { d: 2, c: 0 }, s: { d: 0, c: 15 } },
            { name: 'Poor Project Intelligence', ns: { d: 0, c: 1 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 4 }, s: { d: 0, c: 0 } }
          ],
          'environment': [
            { name: 'Public Relations', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Site Characteristics', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Permits / Consents / Approvals', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } }
          ],
          'external_influences': [
            { name: 'Political', ns: { d: 7, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Economic', ns: { d: 0, c: 2 }, s: { d: 0, c: 5 } },
            { name: 'Legislation / Regulations', ns: { d: 4, c: 7 }, s: { d: 0, c: 8 } },
            { name: 'Technology', ns: { d: 2, c: 0 }, s: { d: 0, c: 0 } },
            { name: 'Other', ns: { d: 0, c: 0 }, s: { d: 0, c: 0 } }
          ]
        }
      }
    };

    const RISK_AREAS_TITLES = {
      'procurement': 'Procurement',
      'project_specific': 'Project Specific',
      'client_specification': 'Client Specification',
      'environment': 'Environment',
      'external_influences': 'External Influences'
    };

    // --- COMPONENTS ---
    
    const Card = ({ children, className = '', noBg = false }) => (
      <div className={`${noBg ? '' : 'bg-white'} rounded-lg shadow-sm border border-slate-200 print-break-inside-avoid print-shadow-none ${className}`}>
        {children}
      </div>
    );

    const SectionHeader = ({ title, icon: Icon, colorClass = "text-emerald-600" }) => (
      <div className="flex items-center gap-2 mb-4 pb-2 border-b border-slate-100">
        {Icon && <Icon className={`w-5 h-5 ${colorClass}`} />}
        <h3 className="font-semibold text-slate-800">{title}</h3>
      </div>
    );

    const Slider = ({ value, onChange, disabled, colorClass = "accent-emerald-600" }) => (
      <div className="relative w-full h-6 flex items-center no-print">
        <input
          type="range"
          min="0"
          max="100"
          value={value}
          onChange={(e) => onChange(Number(e.target.value))}
          disabled={disabled}
          className={`w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer ${colorClass} ${disabled ? 'opacity-30 cursor-not-allowed' : ''}`}
        />
      </div>
    );

    function App() {
      // Load saved state or defaults
      const saved = window.SAVED_STATE || {};
      
      const [activeTab, setActiveTab] = useState('projects'); 
      const [projectName, setProjectName] = useState(saved.projectName || '');
      const [category, setCategory] = useState(saved.category || 'buildings'); 
      const [projectType, setProjectType] = useState(saved.projectType || 'combined');
      const [split, setSplit] = useState(saved.split !== undefined ? saved.split : 50);
      
      // Initialize factors: use saved if exists, otherwise generate defaults based on saved category (or default 'buildings')
      const [mitigations, setMitigations] = useState(() => {
        if (saved.mitigations) return saved.mitigations;
        const initial = {};
        const cat = saved.category || 'buildings';
        Object.entries(CATEGORIES[cat].factors).forEach(([areaKey, factorList]) => {
          factorList.forEach(f => {
             initial[`${areaKey}-${f.name}`] = 0;
          });
        });
        return initial;
      });

      const [activeFactors, setActiveFactors] = useState(() => {
        if (saved.activeFactors) return saved.activeFactors;
        const initial = {};
        const cat = saved.category || 'buildings';
        Object.entries(CATEGORIES[cat].factors).forEach(([areaKey, factorList]) => {
          factorList.forEach(f => {
             initial[`${areaKey}-${f.name}`] = true;
          });
        });
        return initial;
      });

      const [linkTimeOB, setLinkTimeOB] = useState(saved.linkTimeOB !== undefined ? saved.linkTimeOB : true);
      const [manualTimeOB, setManualTimeOB] = useState(saved.manualTimeOB || 10);
      const [linkCostOB, setLinkCostOB] = useState(saved.linkCostOB !== undefined ? saved.linkCostOB : true);
      const [manualCostOB, setManualCostOB] = useState(saved.manualCostOB || 10);
      const [originalCosts, setOriginalCosts] = useState(saved.originalCosts || Array(11).fill(0).map((_, i) => i === 0 ? 100 : 0));
      const [startYear, setStartYear] = useState(saved.startYear || 0);
      const [startMonth, setStartMonth] = useState(saved.startMonth || 1); 
      const [originalDuration, setOriginalDuration] = useState(saved.originalDuration || 12);

      const currentCategoryData = CATEGORIES[category];
      const isOutsourcing = category === 'equip' && projectType === 'standard';
      const colorClass = category === 'civil' ? 'text-amber-600' : category === 'equip' ? 'text-blue-600' : 'text-emerald-600';
      const bgClass = category === 'civil' ? 'bg-amber-600' : category === 'equip' ? 'bg-blue-600' : 'bg-emerald-600';
      const lightBgClass = category === 'civil' ? 'bg-amber-50' : category === 'equip' ? 'bg-blue-50' : 'bg-emerald-50';
      const textClass = category === 'civil' ? 'text-amber-700' : category === 'equip' ? 'text-blue-700' : 'text-emerald-700';
      const sliderClass = category === 'civil' ? 'accent-amber-600' : category === 'equip' ? 'accent-blue-600' : 'accent-emerald-600';

      const handleCategoryChange = (e) => {
        const newCat = e.target.value;
        setCategory(newCat);
        
        if (newCat === 'equip') {
          setProjectType('ns');
        } else {
          setProjectType('combined');
        }

        const currentFactors = CATEGORIES[newCat].factors;
        const newMit = {};
        const newActive = {};
        Object.entries(currentFactors).forEach(([areaKey, factorList]) => {
          factorList.forEach(f => {
            const uniqueId = `${areaKey}-${f.name}`;
            newMit[uniqueId] = 0;
            newActive[uniqueId] = true;
          });
        });
        setMitigations(newMit);
        setActiveFactors(newActive);
      };

      const results = useMemo(() => {
        let totalNsDurWeight = 0;
        let totalNsCapWeight = 0;
        let totalSDurWeight = 0;
        let totalSCapWeight = 0;
        
        let maxNsDurWeight = 0;
        let maxNsCapWeight = 0;
        let maxSDurWeight = 0;
        let maxSCapWeight = 0;

        const catFactors = currentCategoryData.factors;
        const catUpper = currentCategoryData.upper;

        Object.entries(catFactors).forEach(([areaKey, factorList]) => {
          factorList.forEach(f => {
            const uniqueId = `${areaKey}-${f.name}`;
            const isApplicable = activeFactors[uniqueId] !== false; 
            const mitigation = isApplicable ? (mitigations[uniqueId] || 0) : 100;
            const riskFactor = 1 - (mitigation / 100);

            totalNsDurWeight += f.ns.d * riskFactor;
            totalNsCapWeight += f.ns.c * riskFactor;
            totalSDurWeight += f.s.d * riskFactor;
            totalSCapWeight += f.s.c * riskFactor;
            
            maxNsDurWeight += f.ns.d;
            maxNsCapWeight += f.ns.c;
            maxSDurWeight += f.s.d;
            maxSCapWeight += f.s.c;
          });
        });

        // Normalize using Max Weights to ensure Upper Bound is exact
        const nsDurOB = maxNsDurWeight > 0 ? catUpper.ns.duration * (totalNsDurWeight / maxNsDurWeight) : 0;
        const nsCapOB = maxNsCapWeight > 0 ? catUpper.ns.capex * (totalNsCapWeight / maxNsCapWeight) : 0;
        const sDurOB = maxSDurWeight > 0 ? catUpper.s.duration * (totalSDurWeight / maxSDurWeight) : 0;
        const sCapOB = maxSCapWeight > 0 ? catUpper.s.capex * (totalSCapWeight / maxSCapWeight) : 0;

        let finalDurOB = 0;
        let finalCapOB = 0;

        if (projectType === 'ns') {
          finalDurOB = nsDurOB;
          finalCapOB = nsCapOB;
        } else if (projectType === 'standard') {
          finalDurOB = sDurOB;
          finalCapOB = sCapOB;
        } else {
          const nsRatio = split / 100;
          const sRatio = 1 - nsRatio;
          finalDurOB = (nsDurOB * nsRatio) + (sDurOB * sRatio);
          finalCapOB = (nsCapOB * nsRatio) + (sCapOB * sRatio);
        }

        return { finalDurOB, finalCapOB };
      }, [mitigations, activeFactors, projectType, split, currentCategoryData]);

      const reprofileResults = useMemo(() => {
        const timeOverrunPct = (linkTimeOB ? results.finalDurOB : manualTimeOB) / 100;
        const costOverrunPct = (linkCostOB ? results.finalCapOB : manualCostOB) / 100;

        const totalOriginalCost = originalCosts.reduce((a, b) => a + b, 0);
        const totalRevisedCost = totalOriginalCost * (1 + costOverrunPct);
        const revisedDuration = Math.ceil(originalDuration * (1 + timeOverrunPct));
        const durationIncrease = revisedDuration - originalDuration;

        let originalMonthly = [];
        originalCosts.forEach((yearCost, yearIdx) => {
          let monthsInThisYear = 12;
          if (yearIdx === 0) monthsInThisYear = 13 - startMonth;
          const monthlySpend = yearCost / monthsInThisYear;
          for (let m = 0; m < monthsInThisYear; m++) originalMonthly.push(monthlySpend);
        });

        if (originalMonthly.length > originalDuration) originalMonthly = originalMonthly.slice(0, originalDuration);
        else while (originalMonthly.length < originalDuration) originalMonthly.push(0);

        let revisedMonthly = new Array(revisedDuration).fill(0);
        const scaleFactor = originalDuration / revisedDuration; 

        for (let i = 0; i < revisedDuration; i++) {
          const j = i * scaleFactor;
          const index = Math.floor(j);
          revisedMonthly[i] = originalMonthly[Math.min(index, originalMonthly.length - 1)];
        }

        const currentSum = revisedMonthly.reduce((a,b) => a+b, 0);
        const normalizationFactor = currentSum === 0 ? 0 : totalRevisedCost / currentSum;
        revisedMonthly = revisedMonthly.map(v => v * normalizationFactor);

        let revisedYearly = Array(11).fill(0);
        let currentMonthIdx = 0;

        for (let y = 0; y < 11; y++) {
          let monthsInThisYear = 12;
          if (y === 0) monthsInThisYear = 13 - startMonth;
          let yearSum = 0;
          for (let m = 0; m < monthsInThisYear; m++) {
            if (currentMonthIdx < revisedMonthly.length) {
              yearSum += revisedMonthly[currentMonthIdx];
              currentMonthIdx++;
            }
          }
          revisedYearly[y] = yearSum;
        }

        return { totalOriginalCost, totalRevisedCost, revisedDuration, durationIncrease, revisedYearly };
      }, [results, linkTimeOB, manualTimeOB, linkCostOB, manualCostOB, originalCosts, startMonth, originalDuration]);

      const handleMitigationChange = (uniqueId, value) => {
        setMitigations(prev => ({ ...prev, [uniqueId]: value }));
      };

      const toggleFactor = (uniqueId) => {
        setActiveFactors(prev => ({ ...prev, [uniqueId]: !prev[uniqueId] }));
      };

      const setAllMitigation = (areaKey, factorList, value, active = true) => {
        setMitigations(prev => {
          const next = { ...prev };
          factorList.forEach(f => next[`${areaKey}-${f.name}`] = value);
          return next;
        });
        setActiveFactors(prev => {
          const next = { ...prev };
          factorList.forEach(f => next[`${areaKey}-${f.name}`] = active);
          return next;
        });
      };

      const saveProjectFile = () => {
        const stateToSave = {
          projectName, category, projectType, split, mitigations, activeFactors,
          linkTimeOB, manualTimeOB, linkCostOB, manualCostOB, 
          originalCosts, startYear, startMonth, originalDuration
        };

        const jsonState = JSON.stringify(stateToSave);
        const html = document.documentElement.outerHTML;
        
        const regex = /<script id="saved-state">.*?<\/script>/s;
        const scriptTag = '<script id="saved-state">window.SAVED_STATE = ' + jsonState + ';<' + '/script>';
        
        let newHtml;
        if (regex.test(html)) {
          newHtml = html.replace(regex, scriptTag);
        } else {
          newHtml = html.replace('</body>', scriptTag + '</body>');
        }
        
        const blob = new Blob([newHtml], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = (projectName || 'Project') + '_Calculator_Copy.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      };

      const generateReport = () => {
        // Trigger browser print to allow Save as PDF
        window.print();
      };

      return (
        <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
          <header className={`text-white p-4 shadow-md sticky top-0 z-50 transition-colors duration-500 no-print ${category === 'civil' ? 'bg-amber-800' : category === 'equip' ? 'bg-blue-800' : 'bg-emerald-900'}`}>
            <div className="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
              <div className="flex items-center gap-3">
                <Icons.Calculator className={`w-6 h-6 ${category === 'civil' ? 'text-amber-200' : category === 'equip' ? 'text-blue-200' : 'text-emerald-300'}`} />
                <div>
                  <h1 className="text-xl font-bold tracking-tight">HSE Optimism Bias Estimator</h1>
                  <div className="flex items-center gap-2">
                     <span className={`px-2 py-0.5 rounded text-xs font-medium uppercase tracking-wider ${category === 'civil' ? 'bg-amber-700 text-amber-100' : category === 'equip' ? 'bg-blue-700 text-blue-100' : 'bg-emerald-800 text-emerald-200'}`}>
                       {currentCategoryData.name}
                     </span>
                  </div>
                </div>
              </div>
              <div className="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                 <input 
                   type="text" 
                   placeholder="Project Name..." 
                   value={projectName}
                   onChange={(e) => setProjectName(e.target.value)}
                   className="px-3 py-1.5 rounded text-slate-800 text-sm focus:outline-none focus:ring-2 focus:ring-white/50 bg-white/90"
                 />
                 <div className="flex bg-black/20 p-1 rounded-lg">
                   <button onClick={() => setActiveTab('projects')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-colors ${activeTab === 'projects' ? 'bg-white shadow text-slate-900' : 'text-white/70 hover:text-white'}`}>Adjustments</button>
                   <button onClick={() => setActiveTab('reprofiler')} disabled={isOutsourcing} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-colors ${activeTab === 'reprofiler' ? 'bg-white shadow text-slate-900' : isOutsourcing ? 'text-white/30 cursor-not-allowed' : 'text-white/70 hover:text-white'}`} title={isOutsourcing ? "Not available for Outsourcing projects" : ""}>Reprofiler</button>
                 </div>
                 <button onClick={generateReport} className="flex items-center gap-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded text-sm text-white transition-colors" title="Print / Save PDF">
                   <Icons.Printer className="w-4 h-4" />
                   <span className="hidden md:inline ml-1">Print / PDF</span>
                 </button>
                 <button onClick={saveProjectFile} className="flex items-center gap-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded text-sm text-white transition-colors" title="Save Copy of App">
                   <Icons.Save className="w-4 h-4" />
                   <span className="hidden md:inline ml-1">Save App</span>
                 </button>
              </div>
            </div>
          </header>

          <main className="max-w-6xl mx-auto p-4 md:p-6 pb-24">
            
            {/* PRINT-ONLY HEADER FOR PDF */}
            <div className="hidden print-visible mb-8 border-b-2 border-slate-800 pb-4">
               <h1 className="text-2xl font-bold text-slate-900">HSE Optimism Bias Report</h1>
               <div className="grid grid-cols-2 gap-4 mt-4 text-sm">
                  <div><strong>Project Name:</strong> {projectName || 'Untitled'}</div>
                  <div><strong>Date:</strong> {new Date().toLocaleDateString()}</div>
                  <div><strong>Category:</strong> {currentCategoryData.name}</div>
                  <div><strong>Type:</strong> {currentCategoryData.types.find(t => t.id === projectType)?.label}</div>
                  {projectType === 'combined' && <div><strong>Split:</strong> {100-split}% Standard / {split}% Non-Standard</div>}
               </div>
               <div className="mt-6 p-4 bg-slate-100 rounded border-l-4 border-slate-600">
                  <div className="grid grid-cols-2 gap-4">
                     <div>
                       <div className="text-xs uppercase tracking-wider text-slate-500 font-bold">Works Duration Adjustment</div>
                       <div className="text-xl font-bold text-slate-900">{results.finalDurOB.toFixed(1)}%</div>
                     </div>
                     <div>
                       <div className="text-xs uppercase tracking-wider text-slate-500 font-bold">{isOutsourcing ? 'Operating' : 'Capital'} Expenditure Adjustment</div>
                       <div className="text-xl font-bold text-slate-900">{results.finalCapOB.toFixed(1)}%</div>
                     </div>
                  </div>
               </div>
            </div>

            <div className="grid md:grid-cols-2 gap-6 mb-6">
               <Card className="p-4 flex items-center gap-4">
                  <div className={`p-3 rounded-full ${lightBgClass}`}>
                     <currentCategoryData.icon className={`w-6 h-6 ${colorClass}`} />
                  </div>
                  <div className="flex-1">
                     <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Project Category</label>
                     <div className="relative no-print">
                       <select value={category} onChange={handleCategoryChange} className="w-full appearance-none bg-transparent font-semibold text-lg text-slate-800 focus:outline-none cursor-pointer pr-6">
                          {Object.values(CATEGORIES).map(cat => (<option key={cat.id} value={cat.id}>{cat.name}</option>))}
                       </select>
                       <Icons.ChevronRight className="w-4 h-4 absolute right-0 top-1.5 text-slate-400 rotate-90 pointer-events-none" />
                     </div>
                     <div className="hidden print-visible font-bold text-lg">{currentCategoryData.name}</div>
                  </div>
               </Card>
               <Card className="p-4">
                  <label className="block text-xs font-bold text-slate-500 uppercase mb-2">Project Type</label>
                  <div className="flex flex-wrap gap-3 no-print">
                    {currentCategoryData.types.map(t => (
                      <button key={t.id} onClick={() => setProjectType(t.id)} className={`px-3 py-1.5 rounded-md text-sm font-medium border transition-colors ${projectType === t.id ? `${lightBgClass} ${textClass} border-${bgClass}` : 'border-slate-200 text-slate-600 hover:border-slate-300'}`}>{t.label}</button>
                    ))}
                  </div>
                  <div className="hidden print-visible font-bold">{currentCategoryData.types.find(t => t.id === projectType)?.label}</div>
                  {projectType === 'combined' && (
                     <div className="mt-3 pt-3 border-t border-slate-100">
                        <div className="flex justify-between text-xs mb-1">
                          <span>Standard ({100-split}%)</span>
                          <span>Non-Standard ({split}%)</span>
                        </div>
                        <Slider value={split} onChange={setSplit} colorClass={sliderClass} />
                     </div>
                  )}
               </Card>
            </div>

            {/* TAB CONTENT - Always show Adjustments for Print */}
            <div className={`${activeTab === 'projects' ? 'block' : 'hidden'} print-visible`}>
                <div className="grid lg:grid-cols-2 gap-6">
                  {Object.entries(currentCategoryData.factors).map(([areaKey, factors]) => {
                    return (
                      <Card key={areaKey} className="p-5 flex flex-col">
                        <div className="flex items-center justify-between border-b border-slate-100 pb-2 mb-4">
                           <h3 className="font-bold text-slate-800">{RISK_AREAS_TITLES[areaKey]}</h3>
                           <div className="flex gap-2 no-print">
                             <button onClick={() => setAllMitigation(areaKey, factors, 0, true)} className="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded">Reset</button>
                             <button onClick={() => setAllMitigation(areaKey, factors, 100, true)} className="text-xs bg-green-50 hover:bg-green-100 text-green-700 px-2 py-1 rounded">Max Mitigate</button>
                           </div>
                        </div>
                        <div className="space-y-6 flex-1">
                          {factors.map((factor, idx) => {
                            const uniqueId = `${areaKey}-${factor.name}`;
                            const isActive = activeFactors[uniqueId] !== false;
                            const mitVal = mitigations[uniqueId] || 0;
                            return (
                              <div key={idx} className={`transition-opacity ${isActive ? 'opacity-100' : 'opacity-50'}`}>
                                <div className="flex items-start gap-3 mb-2">
                                  <button onClick={() => toggleFactor(uniqueId)} className={`mt-0.5 focus:outline-none hover:opacity-80 transition-colors no-print ${isActive ? colorClass : 'text-slate-400'}`} title={isActive ? "Untick to ignore this risk" : "Tick to apply this risk"}>
                                    {isActive ? <Icons.CheckSquare className="w-5 h-5" /> : <Icons.Square className="w-5 h-5" />}
                                  </button>
                                  <div className="flex-1">
                                    <div className="flex justify-between items-start">
                                      <label className={`text-sm font-medium leading-tight mb-1 cursor-pointer ${isActive ? 'text-slate-800' : 'text-slate-500'}`} onClick={() => toggleFactor(uniqueId)}>{factor.name}</label>
                                      
                                      {/* Screen Badge */}
                                      <span className={`no-print text-xs font-mono font-bold px-1.5 py-0.5 rounded whitespace-nowrap ml-2 ${!isActive ? 'bg-slate-100 text-slate-400' : mitVal === 100 ? 'bg-green-100 text-green-700' : mitVal === 0 ? 'bg-red-50 text-red-600' : lightBgClass + ' ' + textClass}`}>
                                        {!isActive ? 'N/A' : `${mitVal}% Mitigated`}
                                      </span>
                                      
                                      {/* Print Value */}
                                      <span className="hidden mitigation-value ml-2 text-sm">
                                        {!isActive ? 'N/A' : `${mitVal}%`}
                                      </span>
                                    </div>
                                    <Slider value={mitVal} onChange={(v) => handleMitigationChange(uniqueId, v)} disabled={!isActive} colorClass={sliderClass} />
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </Card>
                    );
                  })}
                </div>
            </div>

            {/* REPROFILER SECTION - Always show for Print if not Outsourcing */}
            {(!isOutsourcing) && (
              <div className={`${activeTab === 'reprofiler' ? 'block' : 'hidden'} print-visible page-break`}>
                <h2 className="hidden print-visible text-xl font-bold mb-4 mt-8 pt-4 border-t border-slate-300">Expenditure Reprofiling</h2>
                
                <div className="bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-md flex gap-2 no-print mb-6">
                  <Icons.Info className="w-5 h-5 flex-shrink-0" />
                  <p className="text-sm">This tool simulates a revised expenditure profile by converting annual spend to monthly, applying a duration stretch (based on Time OB), and rescaling costs (based on Cost OB).</p>
                </div>
                
                <div className="grid md:grid-cols-2 gap-6">
                  <Card className="p-5">
                    <SectionHeader title="Duration Parameters" icon={Icons.Calendar} colorClass={colorClass} />
                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Start Year</label>
                          <select value={startYear} onChange={(e) => setStartYear(Number(e.target.value))} className="no-print w-full border-slate-300 rounded-md text-sm py-1.5 focus:ring-2 focus:ring-emerald-500/20">
                             {[0,1,2,3,4,5].map(y => <option key={y} value={y}>Year {y}</option>)}
                          </select>
                          <div className="hidden print-visible font-mono">Year {startYear}</div>
                        </div>
                        <div>
                          <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Start Month</label>
                          <select value={startMonth} onChange={(e) => setStartMonth(Number(e.target.value))} className="no-print w-full border-slate-300 rounded-md text-sm py-1.5 focus:ring-2 focus:ring-emerald-500/20">
                             {Array(12).fill(0).map((_, i) => <option key={i+1} value={i+1}>{i+1}</option>)}
                          </select>
                          <div className="hidden print-visible font-mono">{startMonth}</div>
                        </div>
                      </div>
                      <div>
                        <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Original Duration (Months)</label>
                        <input type="number" min="1" max="120" value={originalDuration} onChange={(e) => setOriginalDuration(Number(e.target.value))} className="no-print w-full border-slate-300 rounded-md text-sm py-1.5 focus:ring-2 focus:ring-emerald-500/20" />
                        <div className="hidden print-visible font-mono">{originalDuration}</div>
                      </div>
                    </div>
                  </Card>
                  <Card className="p-5">
                    <SectionHeader title="Overrun Inputs" icon={Icons.TrendingUp} colorClass={colorClass} />
                    <div className="space-y-4">
                      <div className="flex items-center justify-between">
                         <div className="flex items-center gap-2">
                           <input type="checkbox" checked={linkTimeOB} onChange={(e) => setLinkTimeOB(e.target.checked)} className={`rounded focus:ring-2 ${textClass} focus:ring-offset-0 no-print`} />
                           <span className="text-sm text-slate-700">Link Time OB</span>
                         </div>
                         <div className="flex items-center gap-2">
                           <input type="number" disabled={linkTimeOB} value={linkTimeOB ? results.finalDurOB.toFixed(1) : manualTimeOB} onChange={(e) => setManualTimeOB(Number(e.target.value))} className={`no-print w-20 text-right text-sm border-slate-300 rounded-md py-1 ${linkTimeOB ? 'bg-slate-100 text-slate-500' : 'bg-white'}`} />
                           <span className="text-sm font-bold text-slate-500 hidden md:inline">%</span>
                           <span className="hidden print-visible font-bold">{(linkTimeOB ? results.finalDurOB : manualTimeOB).toFixed(1)}%</span>
                         </div>
                      </div>
                      <div className="flex items-center justify-between">
                         <div className="flex items-center gap-2">
                           <input type="checkbox" checked={linkCostOB} onChange={(e) => setLinkCostOB(e.target.checked)} className={`rounded focus:ring-2 ${textClass} focus:ring-offset-0 no-print`} />
                           <span className="text-sm text-slate-700">Link Cost OB</span>
                         </div>
                         <div className="flex items-center gap-2">
                           <input type="number" disabled={linkCostOB} value={linkCostOB ? results.finalCapOB.toFixed(1) : manualCostOB} onChange={(e) => setManualCostOB(Number(e.target.value))} className={`no-print w-20 text-right text-sm border-slate-300 rounded-md py-1 ${linkCostOB ? 'bg-slate-100 text-slate-500' : 'bg-white'}`} />
                           <span className="text-sm font-bold text-slate-500 hidden md:inline">%</span>
                           <span className="hidden print-visible font-bold">{(linkCostOB ? results.finalCapOB : manualCostOB).toFixed(1)}%</span>
                         </div>
                      </div>
                    </div>
                  </Card>
                </div>
                <Card className="p-6 mt-6">
                  <SectionHeader title="Original Cost Profile (Annual)" icon={Icons.Euro} colorClass={colorClass} />
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left">
                       <thead>
                         <tr className="border-b border-slate-200">
                           {originalCosts.map((_, i) => (
                             <th key={i} className="px-2 py-2 text-slate-500 font-semibold bg-slate-50 whitespace-nowrap min-w-[80px]">Year {i}</th>
                           ))}
                           <th className="px-2 py-2 text-slate-800 font-bold bg-slate-100 min-w-[80px]">Total</th>
                         </tr>
                       </thead>
                       <tbody>
                         <tr>
                           {originalCosts.map((val, i) => (
                             <td key={i} className="p-1">
                               <input type="number" value={val} onChange={(e) => {
                                   const newCosts = [...originalCosts];
                                   newCosts[i] = Number(e.target.value);
                                   setOriginalCosts(newCosts);
                                 }} className="no-print w-full border-slate-200 rounded text-right focus:ring-2 focus:ring-blue-500/20 text-slate-700" />
                               <span className="hidden print-visible text-right block w-full">{val.toLocaleString()}</span>
                             </td>
                           ))}
                           <td className={`p-2 text-right font-bold ${textClass} ${lightBgClass}`}>
                             {reprofileResults.totalOriginalCost.toLocaleString(undefined, { maximumFractionDigits: 0 })}
                           </td>
                         </tr>
                       </tbody>
                    </table>
                  </div>
                </Card>
                <div className="grid lg:grid-cols-3 gap-6 mt-6">
                  <Card className="p-6 lg:col-span-1 bg-slate-800 text-white border-none print-shadow-none">
                     <h3 className="font-bold text-slate-200 mb-6 flex items-center gap-2"><Icons.AlertCircle className="w-5 h-5" /> Impact Summary</h3>
                     <div className="space-y-6">
                       <div>
                         <div className="flex justify-between text-sm text-slate-400 mb-1">Project Duration</div>
                         <div className="flex items-baseline gap-2">
                           <span className="text-2xl font-bold">{originalDuration}</span>
                           <Icons.ChevronRight className="w-4 h-4 text-slate-500" />
                           <span className="text-2xl font-bold text-green-400">{reprofileResults.revisedDuration}</span>
                           <span className="text-sm text-slate-400">months</span>
                         </div>
                       </div>
                       <div className="w-full h-px bg-slate-700"></div>
                       <div>
                         <div className="flex justify-between text-sm text-slate-400 mb-1">Total Capex</div>
                         <div className="flex items-baseline gap-2 flex-wrap">
                           <span className="text-xl font-medium text-slate-500 line-through decoration-slate-600">€{reprofileResults.totalOriginalCost.toLocaleString()}</span>
                           <Icons.ChevronRight className="w-4 h-4 text-slate-500" />
                           <span className="text-2xl font-bold text-green-400">€{reprofileResults.totalRevisedCost.toLocaleString(undefined, { maximumFractionDigits: 0 })}</span>
                         </div>
                       </div>
                     </div>
                  </Card>
                  <Card className="p-6 lg:col-span-2">
                    <SectionHeader title="Adjusted Expenditure Profile" icon={Icons.BarChart3} colorClass={colorClass} />
                    <div className="overflow-x-auto">
                      <table className="w-full text-sm text-left">
                         <thead>
                           <tr className="border-b border-slate-200">
                             {reprofileResults.revisedYearly.map((_, i) => (
                               <th key={i} className="px-2 py-2 text-slate-500 font-semibold bg-slate-50 whitespace-nowrap min-w-[70px]">Year {i}</th>
                             ))}
                             <th className="px-2 py-2 text-slate-800 font-bold bg-slate-100 min-w-[80px]">Total</th>
                           </tr>
                         </thead>
                         <tbody>
                           <tr>
                             {reprofileResults.revisedYearly.map((val, i) => (
                               <td key={i} className="p-2 text-right border-r border-slate-50 text-slate-600 font-mono">
                                 {val > 0 ? val.toLocaleString(undefined, { maximumFractionDigits: 1 }) : '-'}
                               </td>
                             ))}
                             <td className={`p-2 text-right font-bold ${textClass} ${lightBgClass}`}>
                               {reprofileResults.totalRevisedCost.toLocaleString(undefined, { maximumFractionDigits: 0 })}
                             </td>
                           </tr>
                         </tbody>
                      </table>
                    </div>
                  </Card>
                </div>
              </div>
            )}

            <div className="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-slate-100 via-slate-100 to-transparent pointer-events-none z-40 no-print">
               <Card noBg className={`max-w-6xl mx-auto ${category === 'civil' ? 'bg-amber-900' : category === 'equip' ? 'bg-blue-900' : 'bg-emerald-900'} text-white border-none shadow-xl p-4 md:p-6 pointer-events-auto`}>
                 <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
                   {activeTab === 'projects' || isOutsourcing ? (
                     <>
                       <div>
                         <h2 className="text-lg font-bold text-white">Calculated Optimism Bias</h2>
                         <p className="text-sm text-white/70">Category: {currentCategoryData.name}</p>
                       </div>
                       <div className="flex gap-8">
                         <div className="text-center">
                           <div className="text-3xl font-bold">{results.finalDurOB.toFixed(1)}%</div>
                           <div className="text-xs uppercase tracking-wider text-white/60 mt-1 font-semibold">Works Duration</div>
                         </div>
                         <div className="w-px bg-white/20 self-stretch"></div>
                         <div className="text-center">
                           <div className="text-3xl font-bold text-green-300">{results.finalCapOB.toFixed(1)}%</div>
                           <div className="text-xs uppercase tracking-wider text-white/60 mt-1 font-semibold">
                             {isOutsourcing ? 'Operating Expenditure' : 'Capital Expenditure'}
                           </div>
                         </div>
                       </div>
                     </>
                   ) : (
                     <>
                        <div>
                         <h2 className="text-lg font-bold text-white">Reprofile Summary</h2>
                         <p className="text-sm text-white/70">Full Impact Analysis</p>
                       </div>
                       <div className="flex gap-8">
                         <div className="text-center">
                           <div className="text-3xl font-bold flex flex-col items-center">
                              <span className="text-xs font-normal opacity-70 line-through text-white/60">{originalDuration}</span>
                              <span>{reprofileResults.revisedDuration}</span>
                           </div>
                           <div className="text-xs uppercase tracking-wider text-white/60 mt-1 font-semibold">Duration (Months)</div>
                         </div>
                         <div className="w-px bg-white/20 self-stretch"></div>
                         <div className="text-center">
                           <div className="text-3xl font-bold text-green-300 flex flex-col items-center">
                              <span className="text-xs font-normal opacity-70 line-through text-white/60">€{reprofileResults.totalOriginalCost.toLocaleString()}</span>
                              <span>€{reprofileResults.totalRevisedCost.toLocaleString(undefined, { maximumFractionDigits: 0 })}</span>
                           </div>
                           <div className="text-xs uppercase tracking-wider text-white/60 mt-1 font-semibold">
                             Total Cost
                           </div>
                         </div>
                       </div>
                     </>
                   )}
                 </div>
               </Card>
            </div>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>


